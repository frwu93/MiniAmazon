{% extends "base.html" %}

{% block content %}

<br><br>
<a href="{{ url_for('inventory.sellItem') }}" type="button" class="btn btn-dark">Sell a product</a>
<br><br>
<h2>Your products for sale:</h2>
<table class='table table-hover table-bordered container' id="myTable">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Product ID</th>
      <th scope="col">Product Name</th>
      <th scope="col">Product Quantity</th>
      <th scope="col">Price</th>
      <th scope="col">Remove Listing</th>
    </tr>
  </thead>
  <tbody>
    {% for product in avail_products%}
      <tr id={{product.id}}>
        <th scope="row">{{product.id}}</th>
        <td>{{product.name}}</td>
        <td>
          {{product.quantity}} 
          <button type="button" class="btn btn-dark" style="float: right" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal{{product.id}}" data-id={{product.id}}>
            Change
          </button>
          
          <!-- <a href="{{ url_for('inventory.changeQuantity', id=product.id, quantity=10) }}" type="button" class="btn btn-dark" onclick="return confirm('Are you sure?')" style="float: right">Change Quantity</a></td> -->
        <td>{{product.price}}</td>
        <td><a href="{{ url_for('inventory.deleteItem', id=product.id) }}" type="button" class="btn btn-dark" onclick="return confirm('Are you sure?')">Remove listing</a>
        </td>
        <!--<td><button type="button" onclick='productDelete(this);'>Remove</button></td> -->
      </tr>
      
      <div class="modal fade" id="exampleModal{{product.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Enter New Quantity</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <label for="newQuantity">New Quantity: {{product.id}}</label>
                <input class="quantity" type="number" min="1" step="1" id="newQuantity{{product.id}}" name="newQuantity"
                  oninput="validity.valid||(valtmlue='');">

              <button type="button" onclick='passNewQuantity("{{product.id}}");'>Change Quantity</button>
              <script>
                function passNewQuantity(id){
                    var inputVal = document.getElementById("newQuantity"+id).value;
                    alert(id);
                    if(isNaN(inputVal)) alert("Not a numnber");
                    var value = parseFloat(inputVal);
                    alert(Number.isInteger(value));
                    if (value < 1 || !Number.isInteger(value)){ 
                      alert("Quantities must be positive integers");
                      var baseUrl = window.location.href;
                      window.location.href = baseUrl;
                    }
                    else{
                    // Selecting the input element and get its value 
                      var baseUrl = window.location.href;
                      alert(inputVal);
                      var url = baseUrl.concat("/", "changeQuantity", "/", id, "-", inputVal);
                      alert(url);
                      // Displaying the value
                      //var link = "Stupd";
                      window.location.href = url;
                    }
                }
            </script>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
      
    {% endfor %}
  </tbody>
  <script>
    function productDelete(ctl) {
      //var i = ctl.parentNode.parentNode.row.Index;
      //document.getElementById("myTable").deleteRow(0);
      //document.write(id);
      console.log($(ctl).parents("tr"));
      $(ctl).parents("tr").remove();
    }
    </script>
</table>



<br><br>
{% if current_user.is_authenticated %}
<h2>Your recent sales:</h2>
<table class='table table-hover table-bordered container'>
  <thead class="thead-dark">
    <script type="text/javascript">  
      function selects(){  
          var masterCheck = document.getElementById("masterCheck");
          masterCheck.checked = !masterCheck.checked; 
          var ele=document.getElementsByTagName('input');  
          for(var i=0; i<ele.length; i++){  
              if(ele[i].type=='checkbox')  
                  ele[i].checked = !ele[i].checked;  
          }  
      } 
                          
  </script>  
    <tr>
      <th scope="col"><input type="checkbox"  onclick='selects()' value="Select All" id="masterCheck"/> </th>
      <th scope="col">Purchase ID</th>
      <th scope="col">Buyer Address</th>
      <th scope="col">Product ID</th>
      <th scope="col">Quantity</th>
      <th scope="col">Time Ordered</th>
      <th scope="col">Fulfillment Status</th>
    </tr>
  </thead>
  <tbody>
    <form>
      <input type="submit" value="Fulfill" style="float: left">
      <br><br>
      {% for fulfill in order_fulfill%}
        <tr>
          <td>
            <input type="checkbox" name="fulfill-{{fulfill.id}}-{{fulfill.product_id}}"
            value="fulfill" {% if fulfill.fulfilled == "Fulfilled" %} disabled {% else %}{% endif %}>
          </td>
          <th scope="row">{{fulfill.id}}</th>
          <td>{{fulfill.buyer_address}}</td>
          <td>{{fulfill.product_id}}</td>
          <td>{{fulfill.quantity}}</td>
          <td>{{fulfill.time_ordered}}</td>
          <td>{{fulfill.fulfilled}} </td>

        </tr>
      {% endfor %}
    </form>
  </tbody>
</table>
{% else %}
<p><a href="{{ url_for('users.login') }}">Log in</a> to see your purchase history!</p>
{% endif %}

{% endblock %}
